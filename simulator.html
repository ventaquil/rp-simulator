<!DOCTYPE html>
<html>
	<head>
		<title>Simulator</title>
		<script type="text/JavaScript" src="javascript/jquery-2.1.3.min.js"></script>
		<script type="text/JavaScript" src="javascript/kinetic-v5.1.0.min.js"></script>
		<style type="text/CSS">
			body {
				background-color:#EEE;
				text-align:center;
			}
			div#area > div, div#gauss > div {
				background-color:#FFF;
				border:1px solid #000;
			}
			input[type="text"] {
				text-align:right;
				width:90px;
			}
		</style>
		<script type="text/JavaScript">
			function getRandomInt(min,max){
				return Math.floor(Math.random()*(max-min+1))+min;
			}

			var HOWMUCH=10;
			var FLAG=0;

			var elements=new Array();
			for(var i=0;i<19;i++){
				elements[i]=0;
			}

			$(document).ready(function(){
				$('input').removeAttr('disabled');

				var area_size={
					x:400,
					y:600
				};

				var stage=new Kinetic.Stage({
					container:'area',
					height:area_size.x,
					width:area_size.y
				});

				var baselayer=new Kinetic.Layer();

				var mainpoint=new Kinetic.Circle({
					fill:'#000',
					x:(area_size.y/2),
					y:(area_size.x/2),
					radius:2
				});
				var mainpoint_area=new Kinetic.Circle({
					fill:'#0000FF',
					x:(area_size.y/2),
					y:(area_size.x/2),
					opacity:.4,
					radius:40
				});
				baselayer.add(mainpoint,mainpoint_area);

				stage.add(baselayer).draw();

				var gauss=new Kinetic.Stage({
					container:'gauss',
					height:128,
					width:294
				});
				var gausslayer=new Kinetic.Layer();
				gauss.add(gausslayer).draw();

				var layer=new Kinetic.Layer();
				stage.add(layer);
				var point,point_area,line,text,p,t,x,y,rad,inter,a,b;
				$('input.one').on('click',function(){
					FLAG=0;
					$('input').attr('disabled','disabled');

					y=x=0;
					for(var a=0;a<$('input#series').val();a++){
						x+=getRandomInt(0,area_size.y/$('input#series').val());
						y+=getRandomInt(0,area_size.x/$('input#series').val());
					}
					point=new Kinetic.Circle({
						fill:'#F00',
						x:x,
						y:y,
						radius:2
					});
					baselayer.add(point);
					stage.draw();

					p=$('div#text > span').text();
					$('div#text > span').html(++p);

					rad=Math.sqrt(Math.pow((x-(area_size.y/2)),2)+Math.pow((y-(area_size.x/2)),2));
					t=$('div#float > span').text();
					if(rad<=40){
						$('div#float > span').text(++t);
					}

					elements[Math.floor(rad/20)]++;

					$('div#float_area > span').text(Math.round(t/p*1000)/1000);

					point_area=new Kinetic.Circle({
						fill:'#0F0',
						x:x,
						y:y,
						opacity:0,
						radius:0
					});
					line=new Kinetic.Line({
						opacity:.4,
						points:[x,y,x,y],
						stroke:'#F00'
					});
					text=new Kinetic.Text({
						fill:'#000',
						fontFamily:'Calibri',
						fontSize:12,
						text:Math.round(rad*100)/100,
						x:(x+(area_size.y/2))/2,
						y:(y+(area_size.x/2))/2,
						rotation:Math.atan((y-(area_size.x/2))/(x-(area_size.y/2)))*(180/Math.PI)
					});
					layer.add(point_area,line,text);
					stage.draw();

					a=b=0;
					inter=setInterval(function(){
						a+=0.05;
						if(b<rad){
							b+=rad/8;
							if(b>rad){
								b=rad;
							}
						}
						line.points([x,y,((rad-b)/rad)*x+(b/rad)*(area_size.y/2),((rad-b)/rad)*y+(b/rad)*(area_size.x/2)]);
						point_area.opacity(a).radius(b);
						stage.draw();
						if(a>=0.4){
							clearInterval(inter);
							setTimeout(function(){
								inter=setInterval(function(){
									a-=0.05;
									if(a<0){
										a=0;
									}
									point_area.opacity(a);
									line.opacity(a);
									text.opacity(a);
									stage.draw();
									if(a==0){
										point_area.remove();
										line.remove();
										text.remove();
										$('input').removeAttr('disabled');
										clearInterval(inter);
									}
								},50);
							},3000);
						}
					},50);
				});
				$('input.more').on('click',function(){
					FLAG=0;

					for(var a=0;a<HOWMUCH;a++){
						setTimeout(function(){
							$('input').attr('disabled','disabled');

							y=x=0;
							for(var a=0;a<$('input#series').val();a++){
								x+=getRandomInt(0,area_size.y/$('input#series').val());
								y+=getRandomInt(0,area_size.x/$('input#series').val());
							}
							point=new Kinetic.Circle({
								fill:'#F00',
								x:x,
								y:y,
								radius:2
							});
							baselayer.add(point);
							stage.draw();

							p=$('div#text > span').text();
							$('div#text > span').html(++p);

							rad=Math.sqrt(Math.pow((x-(area_size.y/2)),2)+Math.pow((y-(area_size.x/2)),2));
							t=$('div#float > span').text();
							if(rad<=40){
								$('div#float > span').text(++t);
							}

							elements[Math.floor(rad/20)]++;

							$('div#float_area > span').text(Math.round(t/p*1000)/1000);
						},a*100);
					}

					setTimeout(function(){
						$('input').removeAttr('disabled');
					},(HOWMUCH*100)+100);
				});
				$('input.change[type="button"]').on('click',function(){
					var val=$('input.change[type="text"]').val();
					if(val>=5){
						$('input.more').val('Random '+val);
						HOWMUCH=val;
					}
				});
				$('input#draw').on('click',function(){
					FLAG=1;

					var square,max=0,fill;
					for(var i=0;i<19;i++){
						if(elements[i]>max){
							max=elements[i];
						}
					}

					gausslayer.removeChildren();

					for(var i=18;i>=0;i--){
						if((i%6)==0){
							fill='#0F0';
						}
						else if((i%5)==0){
							fill='#00F';
						}
						else if((i%4)==0){
							fill='#F00';
						}
						else if((i%3)==0){
							fill='#FF0';
						}
						else if((i%2)==0){
							fill='#F0F';
						}
						else{
							fill='#0FF';
						}
						square=new Kinetic.Line({
							closed:true,
							fill:fill,
							name:i,
							points:[0,128,16,128,16,128-Math.ceil((120/max)*elements[i]),0,128-Math.ceil((120/max)*elements[i])],
							x:3+(i*16),
							y:0
						});
						square.on('mousemove',function(){
							if(FLAG==1){
								$('div#counter').text(elements[this.name()]);
							}
						})
						.on('mouseleave',function(){
							$('div#counter').text('-');
						});
						gausslayer.add(square);
						gauss.draw();
					}
					
					$('div#gauss').removeAttr('style');
				});
			});
		</script>
	</head>
	<body>
		<div id="area"></div>
		<label for="series">Series:</label><input id="series" type="text" value="1" /><br />
		<input class="one" type="button" value="Random point" />
		<input class="more" type="button" value="Random 10" /><br />
		<input class="change" type="text" value="10" /><input class="change" type="button" value="Change" />
		<div id="text">The drawn points: <span>0</span></div>
		<div id="float">Hits: <span>0</span></div>
		<div id="float_area">Hit rate: <span>0</span></div>
		<input id="draw" type="button" value="Draw" />
		<div id="gauss" style="display:none;"></div>
		<div>Data:</div>
		<div id="counter">-</div>
	</body>
</html>